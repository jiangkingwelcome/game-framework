"use strict";
/**
 * MCP客户端配置模板
 * 支持主流AI编辑器和CLI工具的一键配置
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.MCP_CLIENTS = void 0;
exports.generateJSONConfig = generateJSONConfig;
exports.generateTOMLConfig = generateTOMLConfig;
exports.generateCLICommand = generateCLICommand;
exports.getConfigFilePath = getConfigFilePath;
/**
 * 主流AI编辑器和CLI工具配置信息
 */
exports.MCP_CLIENTS = {
    // ========== IDE编辑器 ==========
    'cursor': {
        id: 'cursor',
        name: 'Cursor',
        description: 'Cursor IDE - AI代码编辑器',
        configFileLocation: {
            macOS: '~/.cursor/mcp.json',
            windows: '%USERPROFILE%\\.cursor\\mcp.json',
            linux: '~/.cursor/mcp.json'
        },
        supportedTransports: ['streamable-http'],
        isIDE: true,
        configFormat: 'json'
    },
    'windsurf': {
        id: 'windsurf',
        name: 'Windsurf',
        description: 'Windsurf IDE - Codeium的AI编辑器',
        configFileLocation: {
            macOS: '~/.codeium/windsurf/mcp_config.json',
            windows: '%USERPROFILE%\\.codeium\\windsurf\\mcp_config.json',
            linux: '~/.codeium/windsurf/mcp_config.json'
        },
        supportedTransports: ['streamable-http'],
        isIDE: true,
        configFormat: 'json'
    },
    'trae': {
        id: 'trae',
        name: 'Trea CN',
        description: 'Trea CN - AI编辑器中文版',
        configFileLocation: {
            macOS: '~/Library/Application Support/Trea CN/User/mcp.json',
            windows: '%APPDATA%\\Trea CN\\User\\mcp.json',
            linux: '~/.config/Trea CN/User/mcp.json'
        },
        supportedTransports: ['streamable-http'],
        isIDE: true,
        configFormat: 'json'
    },
    // ========== CLI工具 ==========
    'codex-cli': {
        id: 'codex-cli',
        name: 'Codex CLI',
        description: 'OpenAI Codex命令行工具',
        configFileLocation: {
            macOS: '~/.codex/config.toml',
            windows: '%USERPROFILE%\\.codex\\config.toml',
            linux: '~/.codex/config.toml'
        },
        supportedTransports: ['streamable-http'],
        isIDE: false,
        configFormat: 'toml'
    },
    'claude-cli': {
        id: 'claude-cli',
        name: 'Claude CLI',
        description: 'Anthropic Claude命令行工具',
        configFileLocation: {
            macOS: '~/.claude/config.json',
            windows: '%USERPROFILE%\\.claude\\config.json',
            linux: '~/.claude/config.json'
        },
        supportedTransports: ['streamable-http'],
        isIDE: false,
        configFormat: 'json'
    },
    'gemini-cli': {
        id: 'gemini-cli',
        name: 'Gemini CLI',
        description: 'Google Gemini命令行工具',
        configFileLocation: {
            macOS: '~/.gemini/settings.json',
            windows: '%USERPROFILE%\\.gemini\\settings.json',
            linux: '~/.gemini/settings.json'
        },
        supportedTransports: ['streamable-http'],
        isIDE: false,
        configFormat: 'json'
    }
};
/**
 * 生成JSON格式的配置内容
 */
function generateJSONConfig(clientType, serverConfig, transport) {
    const client = exports.MCP_CLIENTS[clientType];
    if (client.configFormat !== 'json') {
        throw new Error(`Client ${clientType} does not use JSON format`);
    }
    const mcpServers = {};
    const serverEntry = {};
    // Streamable HTTP配置
    if (!serverConfig.serverUrl) {
        throw new Error('Streamable HTTP transport requires serverUrl');
    }
    // 不同客户端使用不同的字段名
    if (clientType === 'windsurf') {
        // Windsurf使用serverUrl
        serverEntry.serverUrl = serverConfig.serverUrl;
    }
    else if (clientType === 'gemini-cli') {
        // Gemini CLI使用httpUrl
        serverEntry.httpUrl = serverConfig.serverUrl;
    }
    else {
        // Cursor, Trae, Claude CLI, Codex CLI都使用url
        serverEntry.url = serverConfig.serverUrl;
    }
    if (serverConfig.headers && Object.keys(serverConfig.headers).length > 0) {
        serverEntry.headers = serverConfig.headers;
    }
    mcpServers[serverConfig.serverName] = serverEntry;
    const config = {
        mcpServers: mcpServers
    };
    return JSON.stringify(config, null, 2);
}
/**
 * 生成TOML格式的配置内容 (用于Codex CLI)
 */
function generateTOMLConfig(serverConfig) {
    var _a;
    let toml = `[mcp_servers.${serverConfig.serverName}]\n`;
    // Streamable HTTP配置
    if (!serverConfig.serverUrl) {
        throw new Error('Streamable HTTP transport requires serverUrl');
    }
    toml += `url = "${serverConfig.serverUrl}"\n`;
    if ((_a = serverConfig.headers) === null || _a === void 0 ? void 0 : _a['Authorization']) {
        const token = serverConfig.headers['Authorization'].replace('Bearer ', '');
        toml += `bearer_token = "${token}"\n`;
    }
    return toml;
}
/**
 * 生成CLI命令
 */
function generateCLICommand(config) {
    const { clientType, serverConfig, transport, scope } = config;
    switch (clientType) {
        case 'codex-cli':
            return generateCodexCLICommand(serverConfig, transport);
        case 'claude-cli':
            return generateClaudeCLICommand(serverConfig, transport, scope);
        case 'gemini-cli':
            return generateGeminiCLICommand(serverConfig, transport, scope);
        default:
            throw new Error(`Unsupported CLI client: ${clientType}`);
    }
}
/**
 * 生成Codex CLI命令 (Streamable HTTP)
 */
function generateCodexCLICommand(serverConfig, transport) {
    // Codex CLI暂不支持通过命令行添加HTTP服务器
    // 需要手动编辑~/.codex/config.toml文件
    return `# Codex CLI需要手动编辑配置文件 ~/.codex/config.toml\n# 请添加以下内容：\n\n${generateTOMLConfig(serverConfig)}`;
}
/**
 * 生成Claude CLI命令 (Streamable HTTP)
 */
function generateClaudeCLICommand(serverConfig, transport, scope) {
    let command = `claude mcp add`;
    // 添加scope
    if (scope) {
        command += ` --scope ${scope}`;
    }
    // 添加transport为http (Streamable HTTP使用http transport)
    command += ` --transport http`;
    // 添加环境变量
    if (serverConfig.env && Object.keys(serverConfig.env).length > 0) {
        for (const [key, value] of Object.entries(serverConfig.env)) {
            command += ` --env ${key}="${value}"`;
        }
    }
    // 添加HTTP头
    if (serverConfig.headers && Object.keys(serverConfig.headers).length > 0) {
        for (const [key, value] of Object.entries(serverConfig.headers)) {
            command += ` --header "${key}: ${value}"`;
        }
    }
    command += ` ${serverConfig.serverName}`;
    command += ` ${serverConfig.serverUrl}`;
    return command;
}
/**
 * 生成Gemini CLI命令 (Streamable HTTP)
 */
function generateGeminiCLICommand(serverConfig, transport, scope) {
    let command = `gemini mcp add`;
    // 添加scope
    if (scope) {
        command += ` --scope ${scope}`;
    }
    // 添加transport为http
    command += ` --transport http`;
    // 添加环境变量
    if (serverConfig.env && Object.keys(serverConfig.env).length > 0) {
        for (const [key, value] of Object.entries(serverConfig.env)) {
            command += ` --env ${key}="${value}"`;
        }
    }
    // 添加HTTP头
    if (serverConfig.headers && Object.keys(serverConfig.headers).length > 0) {
        for (const [key, value] of Object.entries(serverConfig.headers)) {
            command += ` --header "${key}: ${value}"`;
        }
    }
    command += ` ${serverConfig.serverName}`;
    command += ` ${serverConfig.serverUrl}`;
    return command;
}
/**
 * 获取当前操作系统的配置文件路径
 */
function getConfigFilePath(clientType) {
    const client = exports.MCP_CLIENTS[clientType];
    const platform = process.platform;
    let path;
    if (platform === 'darwin') {
        path = client.configFileLocation.macOS;
    }
    else if (platform === 'win32') {
        path = client.configFileLocation.windows;
    }
    else {
        path = client.configFileLocation.linux;
    }
    if (!path) {
        throw new Error(`Platform ${platform} is not supported for client ${clientType}`);
    }
    // 展开环境变量
    return expandPath(path);
}
/**
 * 展开路径中的环境变量和~
 */
function expandPath(path) {
    // 展开~为home目录
    if (path.startsWith('~')) {
        const home = process.env.HOME || process.env.USERPROFILE;
        if (!home) {
            throw new Error('Cannot determine home directory');
        }
        path = path.replace('~', home);
    }
    // 展开Windows环境变量
    if (process.platform === 'win32') {
        path = path.replace(/%([^%]+)%/g, (_, key) => {
            return process.env[key] || '';
        });
    }
    return path;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWNwLWNsaWVudC1jb25maWdzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc291cmNlL21jcC1jbGllbnQtY29uZmlncy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7QUF3SUgsZ0RBMENDO0FBS0QsZ0RBaUJDO0FBS0QsZ0RBZ0JDO0FBMEZELDhDQW1CQztBQTVSRDs7R0FFRztBQUNVLFFBQUEsV0FBVyxHQUFzQztJQUMxRCwrQkFBK0I7SUFDL0IsUUFBUSxFQUFFO1FBQ04sRUFBRSxFQUFFLFFBQVE7UUFDWixJQUFJLEVBQUUsUUFBUTtRQUNkLFdBQVcsRUFBRSxzQkFBc0I7UUFDbkMsa0JBQWtCLEVBQUU7WUFDaEIsS0FBSyxFQUFFLG9CQUFvQjtZQUMzQixPQUFPLEVBQUUsa0NBQWtDO1lBQzNDLEtBQUssRUFBRSxvQkFBb0I7U0FDOUI7UUFDRCxtQkFBbUIsRUFBRSxDQUFDLGlCQUFpQixDQUFDO1FBQ3hDLEtBQUssRUFBRSxJQUFJO1FBQ1gsWUFBWSxFQUFFLE1BQU07S0FDdkI7SUFDRCxVQUFVLEVBQUU7UUFDUixFQUFFLEVBQUUsVUFBVTtRQUNkLElBQUksRUFBRSxVQUFVO1FBQ2hCLFdBQVcsRUFBRSw4QkFBOEI7UUFDM0Msa0JBQWtCLEVBQUU7WUFDaEIsS0FBSyxFQUFFLHFDQUFxQztZQUM1QyxPQUFPLEVBQUUsb0RBQW9EO1lBQzdELEtBQUssRUFBRSxxQ0FBcUM7U0FDL0M7UUFDRCxtQkFBbUIsRUFBRSxDQUFDLGlCQUFpQixDQUFDO1FBQ3hDLEtBQUssRUFBRSxJQUFJO1FBQ1gsWUFBWSxFQUFFLE1BQU07S0FDdkI7SUFDRCxNQUFNLEVBQUU7UUFDSixFQUFFLEVBQUUsTUFBTTtRQUNWLElBQUksRUFBRSxTQUFTO1FBQ2YsV0FBVyxFQUFFLG9CQUFvQjtRQUNqQyxrQkFBa0IsRUFBRTtZQUNoQixLQUFLLEVBQUUscURBQXFEO1lBQzVELE9BQU8sRUFBRSxvQ0FBb0M7WUFDN0MsS0FBSyxFQUFF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QUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDO1FBQ3pELElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNSLE1BQU0sSUFBSSxLQUFLLENBQUMsaUNBQWlDLENBQUMsQ0FBQztRQUN2RCxDQUFDO1FBQ0QsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFRCxnQkFBZ0I7SUFDaEIsSUFBSSxPQUFPLENBQUMsUUFBUSxLQUFLLE9BQU8sRUFBRSxDQUFDO1FBQy9CLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRTtZQUN6QyxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELE9BQU8sSUFBSSxDQUFDO0FBQ2hCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1DUOWuouaIt+err+mFjee9ruaooeadv1xuICog5pSv5oyB5Li75rWBQUnnvJbovpHlmajlkoxDTEnlt6XlhbfnmoTkuIDplK7phY3nva5cbiAqL1xuXG5leHBvcnQgdHlwZSBUcmFuc3BvcnRUeXBlID0gJ3N0cmVhbWFibGUtaHR0cCc7IC8vIOW9k+WJjemhueebruWPquaUr+aMgXN0cmVhbWFibGUtaHR0cFxuZXhwb3J0IHR5cGUgQ2xpZW50VHlwZSA9ICdjdXJzb3InIHwgJ3dpbmRzdXJmJyB8ICd0cmFlJyB8ICdjb2RleC1jbGknIHwgJ2NsYXVkZS1jbGknIHwgJ2dlbWluaS1jbGknO1xuZXhwb3J0IHR5cGUgQ29uZmlnU2NvcGUgPSAnZ2xvYmFsJyB8ICdwcm9qZWN0JyB8ICd1c2VyJyB8ICdsb2NhbCc7XG5cbi8qKlxuICogTUNQ5a6i5oi356uv6YWN572u5L+h5oGvXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTUNQQ2xpZW50SW5mbyB7XG4gICAgaWQ6IENsaWVudFR5cGU7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgY29uZmlnRmlsZUxvY2F0aW9uOiB7XG4gICAgICAgIG1hY09TPzogc3RyaW5nO1xuICAgICAgICB3aW5kb3dzPzogc3RyaW5nO1xuICAgICAgICBsaW51eD86IHN0cmluZztcbiAgICB9O1xuICAgIHN1cHBvcnRlZFRyYW5zcG9ydHM6IFRyYW5zcG9ydFR5cGVbXTtcbiAgICBpc0lERTogYm9vbGVhbjsgLy8gdHJ1ZeihqOekuklERee8lui+keWZqO+8jGZhbHNl6KGo56S6Q0xJ5bel5YW3XG4gICAgY29uZmlnRm9ybWF0OiAnanNvbicgfCAndG9tbCc7XG59XG5cbi8qKlxuICogTUNQ5pyN5Yqh5Zmo6YWN572u5Y+C5pWwXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTUNQU2VydmVyQ29uZmlnIHtcbiAgICBzZXJ2ZXJOYW1lOiBzdHJpbmc7XG4gICAgc2VydmVyVXJsPzogc3RyaW5nOyAvLyBIVFRQL1NTRS9TdHJlYW1hYmxlLUhUVFDnmoRVUkxcbiAgICBjb21tYW5kPzogc3RyaW5nOyAvLyBTVERJT+eahOWRveS7pFxuICAgIGFyZ3M/OiBzdHJpbmdbXTsgLy8gU1RESU/nmoTlj4LmlbBcbiAgICBlbnY/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+OyAvLyDnjq/looPlj5jph49cbiAgICBoZWFkZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjsgLy8gSFRUUOivt+axguWktFxuICAgIHRpbWVvdXQ/OiBudW1iZXI7IC8vIOi2heaXtuaXtumXtCjmr6vnp5IpXG59XG5cbi8qKlxuICog5ZG95Luk55Sf5oiQ6YWN572uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ0xJQ29tbWFuZENvbmZpZyB7XG4gICAgY2xpZW50VHlwZTogJ2NvZGV4LWNsaScgfCAnY2xhdWRlLWNsaScgfCAnZ2VtaW5pLWNsaSc7XG4gICAgc2VydmVyQ29uZmlnOiBNQ1BTZXJ2ZXJDb25maWc7XG4gICAgdHJhbnNwb3J0OiBUcmFuc3BvcnRUeXBlO1xuICAgIHNjb3BlPzogQ29uZmlnU2NvcGU7XG59XG5cbi8qKlxuICog5Li75rWBQUnnvJbovpHlmajlkoxDTEnlt6XlhbfphY3nva7kv6Hmga9cbiAqL1xuZXhwb3J0IGNvbnN0IE1DUF9DTElFTlRTOiBSZWNvcmQ8Q2xpZW50VHlwZSwgTUNQQ2xpZW50SW5mbz4gPSB7XG4gICAgLy8gPT09PT09PT09PSBJREXnvJbovpHlmaggPT09PT09PT09PVxuICAgICdjdXJzb3InOiB7XG4gICAgICAgIGlkOiAnY3Vyc29yJyxcbiAgICAgICAgbmFtZTogJ0N1cnNvcicsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQ3Vyc29yIElERSAtIEFJ5Luj56CB57yW6L6R5ZmoJyxcbiAgICAgICAgY29uZmlnRmlsZUxvY2F0aW9uOiB7XG4gICAgICAgICAgICBtYWNPUzogJ34vLmN1cnNvci9tY3AuanNvbicsXG4gICAgICAgICAgICB3aW5kb3dzOiAnJVVTRVJQUk9GSUxFJVxcXFwuY3Vyc29yXFxcXG1jcC5qc29uJyxcbiAgICAgICAgICAgIGxpbnV4OiAnfi8uY3Vyc29yL21jcC5qc29uJ1xuICAgICAgICB9LFxuICAgICAgICBzdXBwb3J0ZWRUcmFuc3BvcnRzOiBbJ3N0cmVhbWFibGUtaHR0cCddLFxuICAgICAgICBpc0lERTogdHJ1ZSxcbiAgICAgICAgY29uZmlnRm9ybWF0OiAnanNvbidcbiAgICB9LFxuICAgICd3aW5kc3VyZic6IHtcbiAgICAgICAgaWQ6ICd3aW5kc3VyZicsXG4gICAgICAgIG5hbWU6ICdXaW5kc3VyZicsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnV2luZHN1cmYgSURFIC0gQ29kZWl1beeahEFJ57yW6L6R5ZmoJyxcbiAgICAgICAgY29uZmlnRmlsZUxvY2F0aW9uOiB7XG4gICAgICAgICAgICBtYWNPUzogJ34vLmNvZGVpdW0vd2luZHN1cmYvbWNwX2NvbmZpZy5qc29uJyxcbiAgICAgICAgICAgIHdpbmRvd3M6ICclVVNFUlBST0ZJTEUlXFxcXC5jb2RlaXVtXFxcXHdpbmRzdXJmXFxcXG1jcF9jb25maWcuanNvbicsXG4gICAgICAgICAgICBsaW51eDogJ34vLmNvZGVpdW0vd2luZHN1cmYvbWNwX2NvbmZpZy5qc29uJ1xuICAgICAgICB9LFxuICAgICAgICBzdXBwb3J0ZWRUcmFuc3BvcnRzOiBbJ3N0cmVhbWFibGUtaHR0cCddLFxuICAgICAgICBpc0lERTogdHJ1ZSxcbiAgICAgICAgY29uZmlnRm9ybWF0OiAnanNvbidcbiAgICB9LFxuICAgICd0cmFlJzoge1xuICAgICAgICBpZDogJ3RyYWUnLFxuICAgICAgICBuYW1lOiAnVHJlYSBDTicsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVHJlYSBDTiAtIEFJ57yW6L6R5Zmo5Lit5paH54mIJyxcbiAgICAgICAgY29uZmlnRmlsZUxvY2F0aW9uOiB7XG4gICAgICAgICAgICBtYWNPUzogJ34vTGlicmFyeS9BcHBsaWNhdGlvbiBTdXBwb3J0L1RyZWEgQ04vVXNlci9tY3AuanNvbicsXG4gICAgICAgICAgICB3aW5kb3dzOiAnJUFQUERBVEElXFxcXFRyZWEgQ05cXFxcVXNlclxcXFxtY3AuanNvbicsXG4gICAgICAgICAgICBsaW51eDogJ34vLmNvbmZpZy9UcmVhIENOL1VzZXIvbWNwLmpzb24nXG4gICAgICAgIH0sXG4gICAgICAgIHN1cHBvcnRlZFRyYW5zcG9ydHM6IFsnc3RyZWFtYWJsZS1odHRwJ10sXG4gICAgICAgIGlzSURFOiB0cnVlLFxuICAgICAgICBjb25maWdGb3JtYXQ6ICdqc29uJ1xuICAgIH0sXG5cbiAgICAvLyA9PT09PT09PT09IENMSeW3peWFtyA9PT09PT09PT09XG4gICAgJ2NvZGV4LWNsaSc6IHtcbiAgICAgICAgaWQ6ICdjb2RleC1jbGknLFxuICAgICAgICBuYW1lOiAnQ29kZXggQ0xJJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdPcGVuQUkgQ29kZXjlkb3ku6TooYzlt6XlhbcnLFxuICAgICAgICBjb25maWdGaWxlTG9jYXRpb246IHtcbiAgICAgICAgICAgIG1hY09TOiAnfi8uY29kZXgvY29uZmlnLnRvbWwnLFxuICAgICAgICAgICAgd2luZG93czogJyVVU0VSUFJPRklMRSVcXFxcLmNvZGV4XFxcXGNvbmZpZy50b21sJyxcbiAgICAgICAgICAgIGxpbnV4OiAnfi8uY29kZXgvY29uZmlnLnRvbWwnXG4gICAgICAgIH0sXG4gICAgICAgIHN1cHBvcnRlZFRyYW5zcG9ydHM6IFsnc3RyZWFtYWJsZS1odHRwJ10sXG4gICAgICAgIGlzSURFOiBmYWxzZSxcbiAgICAgICAgY29uZmlnRm9ybWF0OiAndG9tbCdcbiAgICB9LFxuICAgICdjbGF1ZGUtY2xpJzoge1xuICAgICAgICBpZDogJ2NsYXVkZS1jbGknLFxuICAgICAgICBuYW1lOiAnQ2xhdWRlIENMSScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQW50aHJvcGljIENsYXVkZeWRveS7pOihjOW3peWFtycsXG4gICAgICAgIGNvbmZpZ0ZpbGVMb2NhdGlvbjoge1xuICAgICAgICAgICAgbWFjT1M6ICd+Ly5jbGF1ZGUvY29uZmlnLmpzb24nLFxuICAgICAgICAgICAgd2luZG93czogJyVVU0VSUFJPRklMRSVcXFxcLmNsYXVkZVxcXFxjb25maWcuanNvbicsXG4gICAgICAgICAgICBsaW51eDogJ34vLmNsYXVkZS9jb25maWcuanNvbidcbiAgICAgICAgfSxcbiAgICAgICAgc3VwcG9ydGVkVHJhbnNwb3J0czogWydzdHJlYW1hYmxlLWh0dHAnXSxcbiAgICAgICAgaXNJREU6IGZhbHNlLFxuICAgICAgICBjb25maWdGb3JtYXQ6ICdqc29uJ1xuICAgIH0sXG4gICAgJ2dlbWluaS1jbGknOiB7XG4gICAgICAgIGlkOiAnZ2VtaW5pLWNsaScsXG4gICAgICAgIG5hbWU6ICdHZW1pbmkgQ0xJJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdHb29nbGUgR2VtaW5p5ZG95Luk6KGM5bel5YW3JyxcbiAgICAgICAgY29uZmlnRmlsZUxvY2F0aW9uOiB7XG4gICAgICAgICAgICBtYWNPUzogJ34vLmdlbWluaS9zZXR0aW5ncy5qc29uJyxcbiAgICAgICAgICAgIHdpbmRvd3M6ICclVVNFUlBST0ZJTEUlXFxcXC5nZW1pbmlcXFxcc2V0dGluZ3MuanNvbicsXG4gICAgICAgICAgICBsaW51eDogJ34vLmdlbWluaS9zZXR0aW5ncy5qc29uJ1xuICAgICAgICB9LFxuICAgICAgICBzdXBwb3J0ZWRUcmFuc3BvcnRzOiBbJ3N0cmVhbWFibGUtaHR0cCddLFxuICAgICAgICBpc0lERTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ0Zvcm1hdDogJ2pzb24nXG4gICAgfVxufTtcblxuLyoqXG4gKiDnlJ/miJBKU09O5qC85byP55qE6YWN572u5YaF5a65XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUpTT05Db25maWcoXG4gICAgY2xpZW50VHlwZTogQ2xpZW50VHlwZSxcbiAgICBzZXJ2ZXJDb25maWc6IE1DUFNlcnZlckNvbmZpZyxcbiAgICB0cmFuc3BvcnQ6IFRyYW5zcG9ydFR5cGVcbik6IHN0cmluZyB7XG4gICAgY29uc3QgY2xpZW50ID0gTUNQX0NMSUVOVFNbY2xpZW50VHlwZV07XG5cbiAgICBpZiAoY2xpZW50LmNvbmZpZ0Zvcm1hdCAhPT0gJ2pzb24nKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2xpZW50ICR7Y2xpZW50VHlwZX0gZG9lcyBub3QgdXNlIEpTT04gZm9ybWF0YCk7XG4gICAgfVxuXG4gICAgY29uc3QgbWNwU2VydmVyczogYW55ID0ge307XG4gICAgY29uc3Qgc2VydmVyRW50cnk6IGFueSA9IHt9O1xuXG4gICAgLy8gU3RyZWFtYWJsZSBIVFRQ6YWN572uXG4gICAgaWYgKCFzZXJ2ZXJDb25maWcuc2VydmVyVXJsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignU3RyZWFtYWJsZSBIVFRQIHRyYW5zcG9ydCByZXF1aXJlcyBzZXJ2ZXJVcmwnKTtcbiAgICB9XG5cbiAgICAvLyDkuI3lkIzlrqLmiLfnq6/kvb/nlKjkuI3lkIznmoTlrZfmrrXlkI1cbiAgICBpZiAoY2xpZW50VHlwZSA9PT0gJ3dpbmRzdXJmJykge1xuICAgICAgICAvLyBXaW5kc3VyZuS9v+eUqHNlcnZlclVybFxuICAgICAgICBzZXJ2ZXJFbnRyeS5zZXJ2ZXJVcmwgPSBzZXJ2ZXJDb25maWcuc2VydmVyVXJsO1xuICAgIH0gZWxzZSBpZiAoY2xpZW50VHlwZSA9PT0gJ2dlbWluaS1jbGknKSB7XG4gICAgICAgIC8vIEdlbWluaSBDTEnkvb/nlKhodHRwVXJsXG4gICAgICAgIHNlcnZlckVudHJ5Lmh0dHBVcmwgPSBzZXJ2ZXJDb25maWcuc2VydmVyVXJsO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEN1cnNvciwgVHJhZSwgQ2xhdWRlIENMSSwgQ29kZXggQ0xJ6YO95L2/55SodXJsXG4gICAgICAgIHNlcnZlckVudHJ5LnVybCA9IHNlcnZlckNvbmZpZy5zZXJ2ZXJVcmw7XG4gICAgfVxuXG4gICAgaWYgKHNlcnZlckNvbmZpZy5oZWFkZXJzICYmIE9iamVjdC5rZXlzKHNlcnZlckNvbmZpZy5oZWFkZXJzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNlcnZlckVudHJ5LmhlYWRlcnMgPSBzZXJ2ZXJDb25maWcuaGVhZGVycztcbiAgICB9XG5cbiAgICBtY3BTZXJ2ZXJzW3NlcnZlckNvbmZpZy5zZXJ2ZXJOYW1lXSA9IHNlcnZlckVudHJ5O1xuXG4gICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBtY3BTZXJ2ZXJzOiBtY3BTZXJ2ZXJzXG4gICAgfTtcblxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShjb25maWcsIG51bGwsIDIpO1xufVxuXG4vKipcbiAqIOeUn+aIkFRPTUzmoLzlvI/nmoTphY3nva7lhoXlrrkgKOeUqOS6jkNvZGV4IENMSSlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlVE9NTENvbmZpZyhcbiAgICBzZXJ2ZXJDb25maWc6IE1DUFNlcnZlckNvbmZpZ1xuKTogc3RyaW5nIHtcbiAgICBsZXQgdG9tbCA9IGBbbWNwX3NlcnZlcnMuJHtzZXJ2ZXJDb25maWcuc2VydmVyTmFtZX1dXFxuYDtcblxuICAgIC8vIFN0cmVhbWFibGUgSFRUUOmFjee9rlxuICAgIGlmICghc2VydmVyQ29uZmlnLnNlcnZlclVybCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N0cmVhbWFibGUgSFRUUCB0cmFuc3BvcnQgcmVxdWlyZXMgc2VydmVyVXJsJyk7XG4gICAgfVxuICAgIHRvbWwgKz0gYHVybCA9IFwiJHtzZXJ2ZXJDb25maWcuc2VydmVyVXJsfVwiXFxuYDtcblxuICAgIGlmIChzZXJ2ZXJDb25maWcuaGVhZGVycz8uWydBdXRob3JpemF0aW9uJ10pIHtcbiAgICAgICAgY29uc3QgdG9rZW4gPSBzZXJ2ZXJDb25maWcuaGVhZGVyc1snQXV0aG9yaXphdGlvbiddLnJlcGxhY2UoJ0JlYXJlciAnLCAnJyk7XG4gICAgICAgIHRvbWwgKz0gYGJlYXJlcl90b2tlbiA9IFwiJHt0b2tlbn1cIlxcbmA7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRvbWw7XG59XG5cbi8qKlxuICog55Sf5oiQQ0xJ5ZG95LukXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUNMSUNvbW1hbmQoY29uZmlnOiBDTElDb21tYW5kQ29uZmlnKTogc3RyaW5nIHtcbiAgICBjb25zdCB7IGNsaWVudFR5cGUsIHNlcnZlckNvbmZpZywgdHJhbnNwb3J0LCBzY29wZSB9ID0gY29uZmlnO1xuXG4gICAgc3dpdGNoIChjbGllbnRUeXBlKSB7XG4gICAgICAgIGNhc2UgJ2NvZGV4LWNsaSc6XG4gICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVDb2RleENMSUNvbW1hbmQoc2VydmVyQ29uZmlnLCB0cmFuc3BvcnQpO1xuXG4gICAgICAgIGNhc2UgJ2NsYXVkZS1jbGknOlxuICAgICAgICAgICAgcmV0dXJuIGdlbmVyYXRlQ2xhdWRlQ0xJQ29tbWFuZChzZXJ2ZXJDb25maWcsIHRyYW5zcG9ydCwgc2NvcGUpO1xuXG4gICAgICAgIGNhc2UgJ2dlbWluaS1jbGknOlxuICAgICAgICAgICAgcmV0dXJuIGdlbmVyYXRlR2VtaW5pQ0xJQ29tbWFuZChzZXJ2ZXJDb25maWcsIHRyYW5zcG9ydCwgc2NvcGUpO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIENMSSBjbGllbnQ6ICR7Y2xpZW50VHlwZX1gKTtcbiAgICB9XG59XG5cbi8qKlxuICog55Sf5oiQQ29kZXggQ0xJ5ZG95LukIChTdHJlYW1hYmxlIEhUVFApXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlQ29kZXhDTElDb21tYW5kKHNlcnZlckNvbmZpZzogTUNQU2VydmVyQ29uZmlnLCB0cmFuc3BvcnQ6IFRyYW5zcG9ydFR5cGUpOiBzdHJpbmcge1xuICAgIC8vIENvZGV4IENMSeaaguS4jeaUr+aMgemAmui/h+WRveS7pOihjOa3u+WKoEhUVFDmnI3liqHlmahcbiAgICAvLyDpnIDopoHmiYvliqjnvJbovpF+Ly5jb2RleC9jb25maWcudG9tbOaWh+S7tlxuICAgIHJldHVybiBgIyBDb2RleCBDTEnpnIDopoHmiYvliqjnvJbovpHphY3nva7mlofku7Ygfi8uY29kZXgvY29uZmlnLnRvbWxcXG4jIOivt+a3u+WKoOS7peS4i+WGheWuue+8mlxcblxcbiR7Z2VuZXJhdGVUT01MQ29uZmlnKHNlcnZlckNvbmZpZyl9YDtcbn1cblxuLyoqXG4gKiDnlJ/miJBDbGF1ZGUgQ0xJ5ZG95LukIChTdHJlYW1hYmxlIEhUVFApXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlQ2xhdWRlQ0xJQ29tbWFuZChcbiAgICBzZXJ2ZXJDb25maWc6IE1DUFNlcnZlckNvbmZpZyxcbiAgICB0cmFuc3BvcnQ6IFRyYW5zcG9ydFR5cGUsXG4gICAgc2NvcGU/OiBDb25maWdTY29wZVxuKTogc3RyaW5nIHtcbiAgICBsZXQgY29tbWFuZCA9IGBjbGF1ZGUgbWNwIGFkZGA7XG5cbiAgICAvLyDmt7vliqBzY29wZVxuICAgIGlmIChzY29wZSkge1xuICAgICAgICBjb21tYW5kICs9IGAgLS1zY29wZSAke3Njb3BlfWA7XG4gICAgfVxuXG4gICAgLy8g5re75YqgdHJhbnNwb3J05Li6aHR0cCAoU3RyZWFtYWJsZSBIVFRQ5L2/55SoaHR0cCB0cmFuc3BvcnQpXG4gICAgY29tbWFuZCArPSBgIC0tdHJhbnNwb3J0IGh0dHBgO1xuXG4gICAgLy8g5re75Yqg546v5aKD5Y+Y6YePXG4gICAgaWYgKHNlcnZlckNvbmZpZy5lbnYgJiYgT2JqZWN0LmtleXMoc2VydmVyQ29uZmlnLmVudikubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzZXJ2ZXJDb25maWcuZW52KSkge1xuICAgICAgICAgICAgY29tbWFuZCArPSBgIC0tZW52ICR7a2V5fT1cIiR7dmFsdWV9XCJgO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8g5re75YqgSFRUUOWktFxuICAgIGlmIChzZXJ2ZXJDb25maWcuaGVhZGVycyAmJiBPYmplY3Qua2V5cyhzZXJ2ZXJDb25maWcuaGVhZGVycykubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzZXJ2ZXJDb25maWcuaGVhZGVycykpIHtcbiAgICAgICAgICAgIGNvbW1hbmQgKz0gYCAtLWhlYWRlciBcIiR7a2V5fTogJHt2YWx1ZX1cImA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb21tYW5kICs9IGAgJHtzZXJ2ZXJDb25maWcuc2VydmVyTmFtZX1gO1xuICAgIGNvbW1hbmQgKz0gYCAke3NlcnZlckNvbmZpZy5zZXJ2ZXJVcmx9YDtcblxuICAgIHJldHVybiBjb21tYW5kO1xufVxuXG4vKipcbiAqIOeUn+aIkEdlbWluaSBDTEnlkb3ku6QgKFN0cmVhbWFibGUgSFRUUClcbiAqL1xuZnVuY3Rpb24gZ2VuZXJhdGVHZW1pbmlDTElDb21tYW5kKFxuICAgIHNlcnZlckNvbmZpZzogTUNQU2VydmVyQ29uZmlnLFxuICAgIHRyYW5zcG9ydDogVHJhbnNwb3J0VHlwZSxcbiAgICBzY29wZT86IENvbmZpZ1Njb3BlXG4pOiBzdHJpbmcge1xuICAgIGxldCBjb21tYW5kID0gYGdlbWluaSBtY3AgYWRkYDtcblxuICAgIC8vIOa3u+WKoHNjb3BlXG4gICAgaWYgKHNjb3BlKSB7XG4gICAgICAgIGNvbW1hbmQgKz0gYCAtLXNjb3BlICR7c2NvcGV9YDtcbiAgICB9XG5cbiAgICAvLyDmt7vliqB0cmFuc3BvcnTkuLpodHRwXG4gICAgY29tbWFuZCArPSBgIC0tdHJhbnNwb3J0IGh0dHBgO1xuXG4gICAgLy8g5re75Yqg546v5aKD5Y+Y6YePXG4gICAgaWYgKHNlcnZlckNvbmZpZy5lbnYgJiYgT2JqZWN0LmtleXMoc2VydmVyQ29uZmlnLmVudikubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzZXJ2ZXJDb25maWcuZW52KSkge1xuICAgICAgICAgICAgY29tbWFuZCArPSBgIC0tZW52ICR7a2V5fT1cIiR7dmFsdWV9XCJgO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8g5re75YqgSFRUUOWktFxuICAgIGlmIChzZXJ2ZXJDb25maWcuaGVhZGVycyAmJiBPYmplY3Qua2V5cyhzZXJ2ZXJDb25maWcuaGVhZGVycykubGVuZ3RoID4gMCkge1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzZXJ2ZXJDb25maWcuaGVhZGVycykpIHtcbiAgICAgICAgICAgIGNvbW1hbmQgKz0gYCAtLWhlYWRlciBcIiR7a2V5fTogJHt2YWx1ZX1cImA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb21tYW5kICs9IGAgJHtzZXJ2ZXJDb25maWcuc2VydmVyTmFtZX1gO1xuICAgIGNvbW1hbmQgKz0gYCAke3NlcnZlckNvbmZpZy5zZXJ2ZXJVcmx9YDtcblxuICAgIHJldHVybiBjb21tYW5kO1xufVxuXG4vKipcbiAqIOiOt+WPluW9k+WJjeaTjeS9nOezu+e7n+eahOmFjee9ruaWh+S7tui3r+W+hFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29uZmlnRmlsZVBhdGgoY2xpZW50VHlwZTogQ2xpZW50VHlwZSk6IHN0cmluZyB7XG4gICAgY29uc3QgY2xpZW50ID0gTUNQX0NMSUVOVFNbY2xpZW50VHlwZV07XG4gICAgY29uc3QgcGxhdGZvcm0gPSBwcm9jZXNzLnBsYXRmb3JtO1xuXG4gICAgbGV0IHBhdGg6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBpZiAocGxhdGZvcm0gPT09ICdkYXJ3aW4nKSB7XG4gICAgICAgIHBhdGggPSBjbGllbnQuY29uZmlnRmlsZUxvY2F0aW9uLm1hY09TO1xuICAgIH0gZWxzZSBpZiAocGxhdGZvcm0gPT09ICd3aW4zMicpIHtcbiAgICAgICAgcGF0aCA9IGNsaWVudC5jb25maWdGaWxlTG9jYXRpb24ud2luZG93cztcbiAgICB9IGVsc2Uge1xuICAgICAgICBwYXRoID0gY2xpZW50LmNvbmZpZ0ZpbGVMb2NhdGlvbi5saW51eDtcbiAgICB9XG5cbiAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQbGF0Zm9ybSAke3BsYXRmb3JtfSBpcyBub3Qgc3VwcG9ydGVkIGZvciBjbGllbnQgJHtjbGllbnRUeXBlfWApO1xuICAgIH1cblxuICAgIC8vIOWxleW8gOeOr+Wig+WPmOmHj1xuICAgIHJldHVybiBleHBhbmRQYXRoKHBhdGgpO1xufVxuXG4vKipcbiAqIOWxleW8gOi3r+W+hOS4reeahOeOr+Wig+WPmOmHj+WSjH5cbiAqL1xuZnVuY3Rpb24gZXhwYW5kUGF0aChwYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIC8vIOWxleW8gH7kuLpob21l55uu5b2VXG4gICAgaWYgKHBhdGguc3RhcnRzV2l0aCgnficpKSB7XG4gICAgICAgIGNvbnN0IGhvbWUgPSBwcm9jZXNzLmVudi5IT01FIHx8IHByb2Nlc3MuZW52LlVTRVJQUk9GSUxFO1xuICAgICAgICBpZiAoIWhvbWUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGRldGVybWluZSBob21lIGRpcmVjdG9yeScpO1xuICAgICAgICB9XG4gICAgICAgIHBhdGggPSBwYXRoLnJlcGxhY2UoJ34nLCBob21lKTtcbiAgICB9XG5cbiAgICAvLyDlsZXlvIBXaW5kb3dz546v5aKD5Y+Y6YePXG4gICAgaWYgKHByb2Nlc3MucGxhdGZvcm0gPT09ICd3aW4zMicpIHtcbiAgICAgICAgcGF0aCA9IHBhdGgucmVwbGFjZSgvJShbXiVdKyklL2csIChfLCBrZXkpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzLmVudltrZXldIHx8ICcnO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcGF0aDtcbn1cbiJdfQ==